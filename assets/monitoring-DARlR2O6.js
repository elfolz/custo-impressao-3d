import{_ as v,c as h,b as r,w as i,r as d,o as f,d as g,g as y,a as t,t as l,n as w,h as T,p as x,f as L}from"./index-CorlG8Ga.js";const A={data(){return{loading:!1,connected:!1,printerAddress:localStorage.getItem("pinterAddress"),videoUrl:null,imgUrl:null,wsUrl:null,ws:null,hostname:null,deviceState:null,printFileName:null,printProgress:null,currentLayer:null,totalLayer:null,printStartTime:null,printJobTime:null,printLeftTime:null,nozzleTemp:null,bedTemp:null,boxTemp:null,usedMaterialLength:null,fanMain:!1,fanAuxiliary:!1,fanCase:!1,light:!1,addressRules:[n=>/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$/.test(n)||"IP inválido"]}},mounted(){this.printerAddress&&this.connect()},methods:{connect(){this.printerAddress&&(this.loading=!0,this.videoUrl=`http://${this.printerAddress}:8080/?action=stream`,this.imgUrl=`http://${this.printerAddress}/downloads/original/current_print_image.png`,this.wsUrl=`ws://${this.printerAddress}:9999`,this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>{this.connected=!0,this.loading=!1},this.ws.onclose=()=>{this.connected=!1,this.loading=!1},this.ws.onmessage=n=>{if(!n.data)return;const e=JSON.parse(n.data);if(e.hostname&&(this.hostname=e.hostname),e.deviceState&&(this.deviceState=e.deviceState),e.layer&&(this.currentLayer=e.layer),e.TotalLayer&&(this.totalLayer=e.TotalLayer),e.printFileName){const a=e.printFileName.split("/");if(!(a!=null&&a.length))return;this.printFileName=a[a.length-1].replace(/\.gcode/i,"")}e.printStartTime&&(this.printStartTime=new Date(e.printStartTime*1e3)),e.printJobTime&&(this.printJobTime=e.printJobTime),e.printLeftTime&&(this.printLeftTime=e.printLeftTime),e.printProgress&&(this.printProgress=e.printProgress),e.nozzleTemp&&(this.nozzleTemp=parseFloat(e.nozzleTemp).toFixed(2)),e.bedTemp0&&(this.bedTemp=parseFloat(e.bedTemp0).toFixed(2)),e.boxTemp&&(this.boxTemp=parseFloat(e.boxTemp).toFixed(2)),e.usedMaterialLength&&(this.usedMaterialLength=e.usedMaterialLength),e.fan&&(this.fanMain=!!e.fan),e.fanAuxiliary&&(this.fanAuxiliary=!!e.fanAuxiliary),e.fanCase&&(this.fanCase=!!e.fanCase),e.lightSw!=null&&(this.light=!!e.lightSw),location.href.includes("log=true")&&console.log(e)},this.ws.onerror=n=>{this.connected=!1,this.loading=!1,this.$store.dispatch("openAlert",{color:"error",text:"Falha ao conectar com a impressora"}),console.log(n)},this.loadCamera())},loadCamera(){this.$refs.camera.crossOrigin="anonymous",this.$refs.camera.src=this.videoUrl,this.$refs.camera.onload=()=>{console.log("camera loaded")},this.$refs.camera.onerror=()=>{this.$refs.camera.src="/img/empty.webp"}},saveAddress(){/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$/.test(this.printerAddress)&&(localStorage.setItem("pinterAddress",this.printerAddress),this.connect())},toggleLight(){this.light=!this.light,this.ws.send({method:"set",params:{lightSw:this.light?1:0}})},getDeviceState(){return this.deviceState==1?"Em uso":"Disponível"},getPrintStartTime(){var n;return(n=this.printStartTime)==null?void 0:n.toLocaleTimeString()},getPrintJobTime(){const n=parseInt((this.printJobTime??0)/60/60),e=parseInt((this.printJobTime??0)/60%60),a=parseInt((this.printJobTime??0)%60);return`${String(n).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`},getPrintLeftTime(){const n=parseInt((this.printLeftTime??0)/60/60),e=parseInt((this.printLeftTime??0)/60%60),a=parseInt((this.printLeftTime??0)%60);return`${String(n).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`}}},o=n=>(x("data-v-80a0f149"),n=n(),L(),n),I=o(()=>t("figcaption",null,"Câmera não conectada",-1)),C={ref:"camera"},P=["src"],z=o(()=>t("span",null,null,-1)),F=o(()=>t("span",null,"Início da impressão:",-1)),J=o(()=>t("span",null,"Tempo de impressão:",-1)),U=o(()=>t("span",null,"Tempo restante:",-1)),N=o(()=>t("span",null,"Identificação:",-1)),k=o(()=>t("span",null,"Status:",-1)),V=o(()=>t("span",null,"Temperatura do bico:",-1)),M={key:0},D=o(()=>t("span",null,"Temperatura da mesa:",-1)),B={key:0},$={key:0},E=o(()=>t("span",null,"Temperatura da câmara:",-1));function K(n,e,a,O,s,p){const u=d("v-card-title"),S=d("v-text-field"),m=d("v-card-text"),c=d("v-card"),b=d("v-divider");return f(),h("main",null,[r(c,null,{default:i(()=>[r(u,null,{default:i(()=>[g(" Conexão ")]),_:1}),r(m,null,{default:i(()=>[r(S,{modelValue:s.printerAddress,"onUpdate:modelValue":e[0]||(e[0]=_=>s.printerAddress=_),rules:s.addressRules,loading:s.loading,label:"IP da impressora","append-inner-icon":"search",placeholder:"255.255.255.255","onClick:appendInner":e[1]||(e[1]=_=>p.saveAddress()),onKeyup:e[2]||(e[2]=y(_=>p.saveAddress(),["enter"]))},null,8,["modelValue","rules","loading"])]),_:1})]),_:1}),r(c,null,{default:i(()=>[r(u,null,{default:i(()=>[g(" Camera ")]),_:1}),r(m,null,{default:i(()=>[t("figure",null,[I,t("img",C,null,512)])]),_:1})]),_:1}),r(c,null,{default:i(()=>[r(u,null,{default:i(()=>[g(" Impressão ")]),_:1}),r(m,null,{default:i(()=>[t("article",{style:w({"--progress":`${s.printProgress}%`})},[t("header",null,[t("span",null,l(s.printFileName),1)]),t("img",{crossorigin:"anonymous",src:s.imgUrl??"/img/bed.webp",onerror:"this.src='/img/bed.webp'"},null,8,P),z,t("footer",null,[t("span",null,l(s.printProgress??0)+"%",1),t("span",null,"Camada "+l(`${s.currentLayer??0} / ${s.totalLayer??0}`),1)])],4),t("p",null,[F,t("span",null,l(p.getPrintStartTime()),1)]),r(b),t("p",null,[J,t("span",null,l(p.getPrintJobTime()),1)]),t("p",null,[U,t("span",null,l(p.getPrintLeftTime()),1)])]),_:1})]),_:1}),r(c,null,{default:i(()=>[r(u,null,{default:i(()=>[g(" Impressora ")]),_:1}),r(m,null,{default:i(()=>[t("p",null,[N,t("span",null,l(s.hostname),1)]),t("p",null,[k,t("span",null,l(p.getDeviceState()),1)]),t("p",null,[V,s.nozzleTemp?(f(),h("span",M,l(s.nozzleTemp)+" °C",1)):T("",!0)]),t("p",null,[D,s.bedTemp?(f(),h("span",B,l(s.bedTemp)+" °C",1)):T("",!0)]),s.boxTemp?(f(),h("p",$,[E,t("span",null,l(s.boxTemp)+" °C",1)])):T("",!0)]),_:1})]),_:1})])}const W=v(A,[["render",K],["__scopeId","data-v-80a0f149"]]);export{W as default};
