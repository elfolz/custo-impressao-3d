import{_ as I,c as m,a as t,b as s,w as r,T as y,F as x,r as d,o as h,d as c,g as L,n as A,t as l,h as b,p as C,f as P}from"./index-bwazD5ZU.js";const k=""+new URL("../img/disable-block-insecure-private-network-requests.webp",import.meta.url).href,D={computed:{printDoneNotification:{get(){return this.$store.state.printDoneNotification},set(i){this.$store.commit("setPrintDoneNotification",i)}},bedColdNotification:{get(){return this.$store.state.bedColdNotification},set(i){this.$store.commit("setBedColdNotification",i)}}},data(){return{loading:!1,connected:!1,printerAddress:localStorage.getItem("pinterAddress"),videoUrl:null,imgUrl:null,wsUrl:null,ws:null,hostname:null,deviceState:null,printFileName:null,printProgress:null,currentLayer:null,totalLayer:null,printStartTime:null,printJobTime:null,printLeftTime:null,nozzleTemp:null,bedTemp:null,boxTemp:null,usedMaterialLength:null,fanMain:!1,fanAuxiliary:!1,fanCase:!1,light:!1,showInstructions:!localStorage.getItem("ignoreInstructions"),printErrorNotification:!1,addressRules:[i=>/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$/.test(i)||"IP inválido"]}},mounted(){this.printerAddress&&this.connect()},methods:{connect(){this.printerAddress&&(this.loading=!0,this.videoUrl=`http://${this.printerAddress}:8080/?action=stream`,this.imgUrl=`http://${this.printerAddress}/downloads/original/current_print_image.png`,this.wsUrl=`ws://${this.printerAddress}:9999`,this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>{this.connected=!0,this.loading=!1},this.ws.onclose=()=>{this.connected=!1,this.loading=!1},this.ws.onmessage=i=>{var a;if(!i.data)return;const e=JSON.parse(i.data);if(e.hostname&&(this.hostname=e.hostname),e.layer&&(this.currentLayer=e.layer),e.TotalLayer&&(this.totalLayer=e.TotalLayer),e.printStartTime&&(this.printStartTime=new Date(e.printStartTime*1e3)),e.printJobTime&&(this.printJobTime=e.printJobTime),e.printLeftTime&&(this.printLeftTime=e.printLeftTime),e.printProgress&&(this.printProgress=e.printProgress),e.nozzleTemp&&(this.nozzleTemp=parseFloat(e.nozzleTemp).toFixed(2)),e.bedTemp0&&(this.bedTemp=parseFloat(e.bedTemp0).toFixed(2)),e.boxTemp&&(this.boxTemp=parseFloat(e.boxTemp).toFixed(2)),e.usedMaterialLength&&(this.usedMaterialLength=e.usedMaterialLength),e.fan&&(this.fanMain=!!e.fan),e.fanAuxiliary&&(this.fanAuxiliary=!!e.fanAuxiliary),e.fanCase&&(this.fanCase=!!e.fanCase),e.lightSw!=null&&(this.light=!!e.lightSw),location.href.includes("log=true")&&console.log(e),e.deviceState!=null&&(e.deviceState!=this.deviceState&&(this.imgUrl=`http://${this.printerAddress}/downloads/original/current_print_image.png`,this.$forceUpdate()),this.deviceState=e.deviceState),e.printFileName){const u=e.printFileName.split("/");if(!(u!=null&&u.length))return;this.printFileName=u[u.length-1].replace(/\.gcode/i,"")}Notification.permission=="granted"&&((a=e.err)!=null&&a.errcode&&!this.printErrorNotification&&(new Notification("Erro na impressão. Verifdique sua impressora."),this.printErrorNotification=!0),!this.printProgress&&this.printDoneNotification?this.printDoneNotification=!1:this.printProgress>=100&&!this.printDoneNotification&&(new Notification("Impressão concluída!"),this.printDoneNotification=!0),!this.printProgress&&this.bedColdNotification&&(this.bedColdNotification=!1),this.printProgress>=100&&e.boxTemp<=40&&!this.bedColdNotification&&(new Notification("Mesa esfiou. Já pode remover as peças."),this.bedColdNotification=!0))},this.ws.onerror=i=>{this.connected=!1,this.loading=!1,this.$store.dispatch("openAlert",{color:"error",text:"Falha ao conectar com a impressora"}),console.log(i)})},saveAddress(){/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$/.test(this.printerAddress)&&(localStorage.setItem("pinterAddress",this.printerAddress),this.connect())},toggleLight(){this.light=!this.light,this.ws.send({method:"set",params:{lightSw:this.light?1:0}})},ignoreInstructions(){this.showInstructions=!1,localStorage.setItem("ignoreInstructions","true")},getDeviceState(){return this.deviceState==1?"Em uso":"Disponível"},getPrintStartTime(){var i;return(i=this.printStartTime)==null?void 0:i.toLocaleTimeString()},getPrintJobTime(){const i=parseInt((this.printJobTime??0)/60/60),e=parseInt((this.printJobTime??0)/60%60),a=parseInt((this.printJobTime??0)%60);return`${String(i).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`},getPrintLeftTime(){const i=parseInt((this.printLeftTime??0)/60/60),e=parseInt((this.printLeftTime??0)/60%60),a=parseInt((this.printLeftTime??0)%60);return`${String(i).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`}}},o=i=>(C("data-v-2b438313"),i=i(),P(),i),F={ref:"camera"},z=o(()=>t("figcaption",null,"Câmera não conectada",-1)),U=["src"],J=["src"],V=o(()=>t("span",null,null,-1)),E=o(()=>t("span",null,"Início da impressão:",-1)),M=o(()=>t("span",null,"Tempo de impressão:",-1)),B=o(()=>t("span",null,"Tempo restante:",-1)),q=o(()=>t("span",null,"Identificação:",-1)),R=o(()=>t("span",null,"Status:",-1)),K=o(()=>t("span",null,"Temperatura do bico:",-1)),$={key:0},O=o(()=>t("span",null,"Temperatura da mesa:",-1)),W={key:0},j={key:0},G=o(()=>t("span",null,"Temperatura da câmara:",-1)),H={key:0,class:"banner elevation-12"},Q=o(()=>t("p",null,"Para que a câmera e a imagem da impressão funcionem, copie esse link no seu navegador:",-1)),X=o(()=>t("code",null,"chrome://flags#block-insecure-private-network-requests",-1)),Y=o(()=>t("p",null,[c("Altere essa opção para "),t("strong",null,"DISABLED"),c(", como na imagem abaixo:")],-1)),Z=o(()=>t("img",{src:k},null,-1));function ee(i,e,a,u,n,p){const f=d("v-card-title"),v=d("v-text-field"),g=d("v-card-text"),_=d("v-card"),S=d("v-divider"),w=d("v-icon"),N=d("v-btn");return h(),m(x,null,[t("main",null,[s(_,null,{default:r(()=>[s(f,null,{default:r(()=>[c(" Conexão ")]),_:1}),s(g,null,{default:r(()=>[s(v,{modelValue:n.printerAddress,"onUpdate:modelValue":e[0]||(e[0]=T=>n.printerAddress=T),rules:n.addressRules,loading:n.loading,label:"IP da impressora","append-inner-icon":"search",placeholder:"255.255.255.255","onClick:appendInner":e[1]||(e[1]=T=>p.saveAddress()),onKeyup:e[2]||(e[2]=L(T=>p.saveAddress(),["enter"]))},null,8,["modelValue","rules","loading"])]),_:1})]),_:1}),s(_,null,{default:r(()=>[s(f,null,{default:r(()=>[c(" Camera ")]),_:1}),s(g,null,{default:r(()=>[t("figure",F,[z,t("img",{src:n.videoUrl??"/img/empty.webp",onerror:"this.src='/img/empty.webp'",crossorigin:"anonymous"},null,8,U)],512)]),_:1})]),_:1}),s(_,null,{default:r(()=>[s(f,null,{default:r(()=>[c(" Impressão ")]),_:1}),s(g,null,{default:r(()=>[t("article",{style:A({"--progress":`${n.printProgress}%`})},[t("header",null,[t("span",null,l(n.printFileName),1)]),t("img",{src:n.imgUrl??"/img/bed.webp",onerror:"this.src='/img/bed.webp'",crossorigin:"anonymous"},null,8,J),V,t("footer",null,[t("span",null,l(n.printProgress??0)+"%",1),t("span",null,"Camada "+l(`${n.currentLayer??0} / ${n.totalLayer??0}`),1)])],4),t("p",null,[E,t("span",null,l(p.getPrintStartTime()),1)]),s(S),t("p",null,[M,t("span",null,l(p.getPrintJobTime()),1)]),t("p",null,[B,t("span",null,l(p.getPrintLeftTime()),1)])]),_:1})]),_:1}),s(_,null,{default:r(()=>[s(f,null,{default:r(()=>[c(" Impressora ")]),_:1}),s(g,null,{default:r(()=>[t("p",null,[q,t("span",null,l(n.hostname),1)]),t("p",null,[R,t("span",null,l(p.getDeviceState()),1)]),t("p",null,[K,n.nozzleTemp?(h(),m("span",$,l(n.nozzleTemp)+" °C",1)):b("",!0)]),t("p",null,[O,n.bedTemp?(h(),m("span",W,l(n.bedTemp)+" °C",1)):b("",!0)]),n.boxTemp?(h(),m("p",j,[G,t("span",null,l(n.boxTemp)+" °C",1)])):b("",!0)]),_:1})]),_:1})]),s(y,{name:"fade"},{default:r(()=>[n.showInstructions?(h(),m("footer",H,[Q,X,Y,Z,s(N,{block:"",onClick:e[3]||(e[3]=T=>p.ignoreInstructions())},{default:r(()=>[s(w,{icon:"check"}),c(" Não mostrar mais esse aviso")]),_:1})])):b("",!0)]),_:1})],64)}const ie=I(D,[["render",ee],["__scopeId","data-v-2b438313"]]);export{ie as default};
